---
layout: post
title:  "进程详解"
data: 星期五, 06. 三月 2020 01:29下午 
categories: 操作系统
tags: 专题
---
* 该模块会针对操作系统中的某一块知识做专题整理，也许会有些不足或者错误的地方，未来可能会作修改。

#  操作系统专题2----进程详解

* 本文会接着上一个专题 再讲一下进程的一些东西

## 进程控制块（PCB）
#### 什么是进程控制块
进程控制块是操作系统管理控制进程运行所用的信息集合。

操作系统用PCB来描述进程的基本情况以及运行变化的进程，PCB是进程存在的唯一标志。

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-190513.png)

#### 进程控制块的组织方式

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-190628.png)

一般用链表，因为可以动态插入和删除，但是如果从开始到结尾进程的数目就固定可以采用索引的方式。（下面的消息队列是用链表实现的队列，实际还是链表）

#### 进程控制块包含的三大类消息
![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-191304.png)

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-191309.png)

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-191313.png)


## 进程状态

>
这里先不讲死锁，死锁会另开一章

** 进程有三个状态：运行态、就绪态和等待（阻塞）态 **

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-162600.png)

#### 进程阻塞
进程只能自己阻塞自己，因为只有进程自身才知道何时需要等待某种事情的发送。

** 进程阻塞的可能原因：**

1.请求并等待系统服务，无法马上完成

2.启动某种操作，无法马上完成

3.需要的数据没有到达

#### 进程就绪

** 进程唤醒（阻塞->就绪）的可能原因： **

1.被阻塞的进程需要的资源可被满足

2.被阻塞进程等待的时间到达

3.将该进程的PCB插入到就绪队列

** 运行->就绪的可能原因 **

时间片用完

#### 进程挂起
进程在挂起状态，意味着进程没有占用内存空间，处于挂起状态的进程映像在磁盘上。（内存页被换出）

** 进程阻塞挂起：**进程在外存并等待某事件出现

** 就绪挂起状态：**进程在外存，但只要进入内存，即可运行。

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-171331.png)


## 状态队列与上下文切换

#### 状态队列

由操作系统维护的一组队列，用来表示系统中所有进程的当前状态，不同的状态分别用不同的队列来表示（就绪队列和各种阻塞队列）。每个进程 PCB都根据它的状态加入到相应的队列中，当一个进程 状态发送变化时，它的PCB从一个状态队列脱离出来，加入到另外一个队列。

因为优先级不同或者阻塞原因不同会有许多个队列。

* 这里起始还有一个僵尸队列  放置僵尸进程 僵尸进程的概念后面会讲

#### 进程上下文切换
停止当前运行程序（从运行状态改为其他状态）并且调度其他进程（转变称运行状态）

** 需要存储的上下文： ** 寄存器、虚拟内存、栈等资源和CPU状态等

这些上下文会储存到PCB的一个位置，恢复的时候拿出来。

## 进程控制
#### 进程创建（fork函数）
  fork函数，它从已存在进程中创建一个新进程。新进程为子进程，而原进程为父进程。
  
** 创建进程的一般工作：**

1.分配一个PCB，拷贝父进程的PCB的绝大部分数据

2.给子进程分配资源

3.复制父进程地址空间的数据

4.将进程状态置为就绪态，插入就绪队列

** fork函数的返回值：** 子进程返回0，父进程返回的是子进程的pid。

#### 进程等待
![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200308-203600.png)

Wait的作用：比如父进程可以帮助子进程内存（PCB）回收。


#### 进程终止

在子进程调用了exit但是资源没有被父进程回收，就是一个僵尸进程，如果父进程先于子进程没了，那么就要靠根进程（最早的进程 ）定期扫描来回收僵尸进程









