---
layout: post
title:  "协程"
data: 星期五, 20. 三月 2020 03:16下午 
categories: 操作系统
tags: 专题
---
* 该模块会针对操作系统中的某一块知识做专题整理，也许会有些不足或者错误的地方，未来可能会作修改。

# 操作系统专题10----协程

协程，英文Coroutines，是一种比线程更加轻量级的存在。正如一个进程可以拥有多个线程一样，一个线程也可以拥有多个协程。

协程是单线程下实现多任务

协程共享堆，不共享栈。

协程不是被操作系统内核所管理，而完全是由程序所控制（也就是在用户态执行）。

协程的暂停完全由程序控制，线程的阻塞状态是由操作系统内核来进行切换。因此，协程的开销远远小于线程的开销。

协程不是进程也不是线程，而是一个**特殊的函数**，这个函数可以在某个地方挂起，并且可以重新在挂起处外继续运行。所以说，协程与进程、线程相比并不是一个维度的概念。


一个线程的多个协程的运行是串行的。如果是多核CPU，多个进程或一个进程内的多个线程是可以并行运行的，但是一个线程内协程却绝对是串行的，无论CPU有多少个核。所以一旦协程出现阻塞，将会阻塞整个线程

协程与进程一样，切换是存在上下文切换问题的。协程的切换者是用户（编程者或应用程序），切换时机是用户自己的程序所决定的。协程拥有自己的寄存器上下文和栈。协程的切换内容是硬件上下文，切换内存保存在用户自己的变量（用户栈或堆）中。协程的切换过程只有用户态，**即没有陷入内核态，因此切换效率高。**

## 优点：
1.跨平台

2.无需线程上下文切换的开销

3.无需原子操作锁定及同步的开销（因为是串行执行的）

4.方便切换控制流，简化编程模型

5.十分轻量

## 缺点：
1.无法利用多核资源：协程的本质是个单线程,它不能同时将 单个CPU 的多个核用上,协程需要和进程配合才能运行在多CPU上.当然我们日常所编写的绝大部分应用都没有这个必要，除非是cpu密集型应用。

2.进行阻塞（Blocking）操作（如IO时）会阻塞掉整个程序：这一点和事件驱动一样，可以使用异步IO操作来解决