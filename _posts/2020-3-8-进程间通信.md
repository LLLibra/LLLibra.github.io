---
layout: post
title:  "进程间通信"
data: 星期五, 08. 三月 2020 01:29下午 
categories: 操作系统
tags: 专题
---
* 该模块会针对操作系统中的某一块知识做专题整理，也许会有些不足或者错误的地方，未来可能会作修改。

#  操作系统专题3----进程间通信IPC

## 通信简介
1.通信根据是否通过中间缓存分为直接通信和间接通信，通过是否阻塞也可分，阻塞的分为通过，非阻塞被认为是异步的。


## 信号
信号是Unix系统中使用的最古老的进程间通信的方法之一。操作系统通过信号来通知进程系统中发生了某种预先规定好的事件（一组事件中的一个），它也是用户进程之间通信和同步的一种原始机制。一个键盘中断或者一个错误条件（比如进程试图访问它的虚拟内存中不存在的位置等）都有可能产生一个信号。

#### 信号事件主要有两个来源：
![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200310-223205.png)

#### 优点

轻量级快速

#### 实现方式
1.应用程序在程序开始前先要注册一个handler（处理函数），当操作系统获得某个信号的时候就会用这个函数处理。

2.操作系统收到信号，当时正在内核态，操作系统将从内核态到用户态的返回入口改为处理函数的入口，同时也要把信号处理函数之后我们要去的地方修改好，即被打断的地方。（这一步都需要修改堆栈，我们一般不会这么做，病毒会这么做）




## 管道/匿名管道/无名管道（PIPE）
管道是半双工，数据只能向一个方向流动；双方需要互相通信时，需要建立起两个管道。

管道的通信方式为：写端每次都将数据写入管道缓冲区的** 末尾 **
，而读端每次都从管道缓冲区的** 头部  **读出数据。

#### 实现原理
管道的实质是内核利用** 环形队列 **的数据结构在
** 内核缓冲区 **中的一个实现

当缓冲区读空或者写满时，有一定的规则控制相应的读进程或者写进程进入等待队列，当空的缓冲区有新数据写入或者满的缓冲区有数据读出来时，就唤醒等待队列中的进程继续读写。
#### 缺点
1.只能在具有亲缘关系的进程间通信，

2.只能单向传输数据，另外管道的缓冲区是有限的

3.没有名称

## 命名管道（FIFO）
FIFO可以在无关的进程之间交换数据，与无名管道不同。

仍需要满足 先入先出的原则

命名管道不同于匿名管道之处在于它提供了一个路径名与之关联，以命名管道的文件形式存在于文件系统中，这样，即使与命名管道的创建进程不存在亲缘关系的进程，只要可以访问该路径，就能够彼此通过命名管道相互通信，因此，通过命名管道不相关的进程也能交换数据。

#### 优点

1.有名管道克服了管道没有名字的限制，

2.它还允许无亲缘关系进程间的通信；

#### 缺点
仍是字节流不是结构化数据

## 消息队列
消息队列是存放在内核中的消息链表，每个消息队列由消息队列标识符表示。

消息队列存放在内核中，只有在内核重启(即，操作系统重启)或者显示地删除一个消息队列时，该消息队列才会被真正的删除。

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200310-223542.png)

#### 优点： 
传结构化的数据，不需要父子进程的关系

#### 缺点：
但是信息的复制需要额外消耗CPU的时间．不适宜于信息量大或操作频繁的场合。

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200308-204921.png)

## 共享内存

采用共享内存通信的一个显而易见的好处是效率高，因为进程可以直接读写内存，而不需要任何数据的拷贝。** 对于像管道和消息队列等通信方式，则需要在内核和用户空间进行四次的数据拷贝，而共享内存则只拷贝两次数据：一次从输入文件到共享内存区，另一次从共享内存区到输出文件。 **实际上，进程之间在共享内存时，并不总是读写少量数据后就解除映射，有新的通信时，再重新建立共享内存区域。而是保持共享区域，直到通信完毕为止，这样，数据内容一直保存在共享内存中，并没有写回文件。共享内存中的内容往往是在解除映射时才写回文件的。因此，采用共享内存的通信方式效率是非常高的。

>
![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200310-223901.png)

#### 优点：
共享内存针对消息缓冲的缺点改而利用内存缓冲区直接交换信息，无须复制，快捷、信息量大是其优点。

#### 缺点：
共享内存的通信方式是通过将共享的内存缓冲区直接附加到进程的虚拟地址空间中来实现的．因此，这些进程之间的读写操作的同步问题操作系统无法实现。必须由各进程利用其他同步工具解决。另外，由于内存实体存在于计算机系统中．所以只能由处于同一个计算机系统中的诸进程共享。不方便网络通信。

#### 实现方式
实现方式：通过将同一块物理内存映射到不同的地址空间，这样不同的虚地址就可以访问到一个地址

## socket套接字
套接字是网络编程的api，通过套接字可以不同的机器间的进程进行通信，常用于客户端进程和服务器进程的通信。



