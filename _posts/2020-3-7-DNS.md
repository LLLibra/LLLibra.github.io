---
layout: post
title:  "DNS"
data: 星期六, 07. 三月 2020 01:16下午 
categories: 计算机网络
tags: 专题
---
* 该模块会针对计算机网络中的某一块知识做专题整理，也许会有些不足或者错误的地方，未来可能会作修改。

#  计算机网络专题4----DNS知识整理


## 简介

域名系统DNS(Domain Name System)是因特网使用的命名系统，用来解决的是IP地址和域名的映射问题，属于**应用层协议**，端口号53,基于UDP，以达到DNS服务器负载更低， 响应更快的效果。。

DNS是一个分布式层级式的系统，它分为根域名服务器，顶级域名服务器，权威域名服务器3层。一般由ISP提供的本地域名服务器来代理用户主机来进行查询。

为了提高域名服务器的可靠性，DNS域名服务器把数据复制到几个域名服务器来保存，其中一个为主域名服务器，其他的是辅助域名服务器。主域名服务器与辅助域名服务器要完成复制信息，同步等操作采用TCP协议传输，这样一是保证数据的可靠性，二是要进行的同步操作比请求应答的数量大得多，所以需要采用报文更大的TCP操作。


## DNS功能
DNS是多层命名服务器构成的分布式数据库。

域名到IP地址的翻译

主机别名（即反向解析的时候一个ip可以对应多个域名）

邮件服务器别名

负载均衡(一个域名可能对应多个ip，DNS会根据负载均衡算法给出一个最合理的ip)


## 因特网的域名结构
>
要了解DNS首先需要了解域名结构

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-142720.png)

如果采用上述的树状结构，每一个节点都采用一个域名服务器，这样会使得域名服务器的数量太多，使域名服务器系统的运行效率降低。所以在DNS中，采用划分区的方法来解决。**一个服务器所负责管辖(或有权限)的范围叫做区(zone)。**各单位根据具体情况来划分自己管辖范围的区。但在一个区中的所有节点必须是能够连通的。每一个区设置相应的权限域名服务器，用来保存该区中的所有主机到域名IP地址的映射。

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-143207.png)

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200307-143302.png)

#### 根域名服务器：
最高层次的域名服务器，也是最重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和IP地址。不管是哪一个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析，就首先求助根域名服务器。所以根域名服务器是最重要的域名服务器。假定所有的根域名服务器都瘫痪了，那么整个DNS系统就无法工作。需要注意的是，在很多情况下，根域名服务器并不直接把待查询的域名直接解析出IP地址，而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进行查询。

#### 顶级域名服务器：
负责管理在该顶级域名服务器注册的二级域名。

#### 权限（权威）域名服务器：
负责一个“区”的域名服务器。当一个权限域名服务器不能给出查询回答时，会告诉查询客户，下一步应当找那一个权限域名服务器。

#### 本地域名服务器：
本地服务器不属于下图的域名服务器的层次结构，但是它对域名系统非常重要，一般由ISP(Internet Service Provider)，互联网服务提供商提供。作为代理，将查询转发到（层级式）域名解析服务器系统。当一个主机发出DNS查询请求时，这个查询请求报文就发送给本地域名服务器。


## DNS缓存
当我们想使用DNS功能的时候

1.首先会查浏览器的DNS缓存

2.然后查电脑中的DNS缓存（host文件）

3.接着查找本地DNS服务器缓存： 每个居民区，机构都有一台本地DNS服务器，由ISP提供（网络服务提供商如电信移动网通）。当主机与ISP相连时，ISP提供主机的IP地址。

如果都查不到才会进行DNS查询阶段。

## DNS查询
>
DNS是一个分布式层级式的系统，它分为根域名服务器，顶级域名服务器，权威域名服务器3层(所以可以说是**三层查询**)。一般由ISP提供的本地域名服务器来代理用户主机来进行查询。

#### 递归查询
即客户机使用该方法向DNS服务器发起请求，DNS服务器必须以一个准备的查询结果回复客户机。如果DNS服务器本地没有储存DNS信息，那么该服务器会询问其他服务器，并将返回的查询结果提交给客户机。


#### 迭代查询
当客户机（DNS服务器本身也会是客户机）发送询问请求，DNS服务器并不直接回复查询结果，而是告诉客户机另一台DNS服务器地址，客户机再向这台DNS服务器提交
请求，一次循环直到返回查询结果为止。

* 一般从PC客户端到本地DNS服务器属于递归查询。而DNS服务器之间的交互查询就是迭代查询

## DNS解析

正向解析：从域名到IP的解析过程。

反向解析：从IP地址到域名的解析过程。反向解析的作用就是为服务器的身份验证。

## DNS劫持
攻击者在DNS服务器之前将虚假的响应交给用户，从而欺骗客户端去访问恶意的网站。假设当提交给某个域名服务器的域名解析请求的数据包被截获，然后按截获者的意图将一个虚假的IP地址作为应答信息返回给请求者。这时，原始请求者就会把这个虚假的IP地址作为它所要请求的域名而进行连接，显然它被欺骗到了别处而根本连接不上自己想要连接的那个域名。








