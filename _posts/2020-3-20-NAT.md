---
layout: post
title:  "NAT"
data: 星期五, 20. 三月 2020 09:28上午 
categories: 计算机网络
tags: 专题
---
* 该模块会针对计算机网络中的某一块知识做专题整理，也许会有些不足或者错误的地方，未来可能会作修改。

#计算机网络专题7----NAT（Network Address Translation，网络地址转换）

##产生原因

IPv4地址基本耗尽

##公网IP和私网IP

只有公网ip是能够连接互联网的，私网IP 一般只用作局域网

####公网IP
百度查出来的地址是你上网的公网IP，也许并不是你主机的地址，而是电信或联通分给你的地址，用于连接互联网。



####私网IP
在后端输入config则出的是私网IP

1.私有 IP 的路由信息不能对外散播 (只能存在内部网络)；

2.使用私有 IP 作为来源或目的地址的封包，不能透过 Internet 来转送 (不然网络会混乱)；

3.关于私有 IP 的参考纪录(如 DNS)，只能限于内部网络使用 (一样的原理啦)

4.私网IP的好处在于，由于他的私有路由不能对外直接提供信息，所以，你的内部网络将不会直接被 Internet 上面的 Cracker 所攻击！

##NAT的作用（将私网IP转化为公网IP）

####整理上网流程

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200320-131207.png)

网络访问只能先由私网侧发起，公网无法主动访问私网主机；

NAT网关为了实现双向翻译的功能，需要维护一张关联表，把会话的信息保存下来。

##静态NAT
如果一个内部主机唯一占用一个公网IP，这种方式被称为一对一模型。此种方式下，转换上层协议就是不必要的，因为一个公网IP就能唯一对应一个内部主机。显然，这种方式对节约公网IP没有太大意义，主要是为了实现一些特殊的组网需求。比如用户希望隐藏内部主机的真实IP，或者实现两个IP地址重叠网络的通信。

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200320-130638.png)

##动态NAT
它能够将未注册的IP地址映射到注册IP地址池中的一个地址。不像使用静态NAT那样，你无需静态地配置路由器，使其将每个内部地址映射到一个外部地址，但必须有足够的公有因特网IP地址，让连接到因特网的主机都能够同时发送和接收分组

![](https://github.com/LLLibra/LLLibra.github.io/raw/master/_posts/imgs/20200320-130716.png)


##NAT重载
**这是最常用的NAT类型。**NAT重载也是动态NAT，它利用源端口将多个私网ip地址映射到一个公网ip地址(多对一)。

当有多个内部主机去访问同一个服务器时，从返回的信息不足以区分响应应该转发到哪个内部主机。此时，需要NAT设备**根据传输层信息或其他上层协议去区分不同的会话**，并且可能要对上层协议的标识进行转换，比如TCP或UDP端口号。这样NAT网关就可以将不同的内部连接访问映射到同一公网IP的不同传输层端口，通过这种方式实现公网IP的复用和解复用。

>
举个例子，客户端172.18.250.6和百度服务器202.108.22.5通信，172.18.250.6发送数据时，先转换为219.155.6.240:1723（任意>1024的随机端口），然后再利用这个身份发送数据给百度服务器，然后百度服务器回应数据并发送给219.155.6.240:1723，NAT网关检查自己的关联表，意识到这是自己地私网中172.18.250.6的数据包，然后把这个数据发送给客户端

