---
layout: post
title:  "一致性哈希"
data: 星期日, 19. 四月 2020 10:21上午  
categories: 算法
tags: 专题
---
* 该模块会针对算法中的某一块知识做专题整理，也许会有些不足或者错误的地方，未来可能会作修改。

#  算法专题6----一致性哈希

## 算法目的


## 应用场景 
随着业务的扩展，流量的剧增，单体项目逐渐划分为分布式系统。对于经常使用的数据，我们可以使用Redis作为缓存机制，减少数据层的压力。

把常用的数据保存到Redis中，为了实现高可用使用了3台Redis（没有设置集群，集群至少要6台）。每次Redis请求会随机发送到其中一台，但是这种策略会引发如下两个问题：

1.同一份数据可能在多个Redis数据库，造成数据冗余

2.某一份数据在其中一台Redis数据库已存在，但是再次访问Redis数据库，并没有命中数据已存在的库。**即无法保证对相同的key的所有访问都发送到相同的Redis中。**

要解决上述的问题，我们需要稍稍改变一些key存入Redis的规则：使用hash算法

但是hash算法也会面临容错性和扩展性的问题。容错性是指当系统中的某个服务出现问题时，不能影响其他系统。扩展性是指当加入新的服务器后，整个系统能正确高效运行。

> #### 举例
>
例如，有三台Redis，对于每次的访问都可以通过计算hash来求得hash值。
如公式 h=hash(key)%3，我们把Redis编号设置成0,1,2来保存对应hash计算出来的值，h的值等于Redis对应的编号。
>
现假设有一台Redis服务器宕机了，那么为了填补空缺，要将宕机的服务器从编号列表中移除，后面的服务器按顺序前移一位并将其编号值减一，此时每个key就要按h = Hash(key) % 2重新计算。
>
同样，如果新增一台服务器，规则也同样需要重新计算，h = Hash(key) % 4。
>
**因此，系统中如果有服务器更变，会直接影响到Hash值，大量的key会重定向到其他服务器中，造成缓存命中率降低，而这种情况在分布式系统中是十分糟糕的。一个设计良好的分布式哈希方案应该具有良好的单调性，即服务节点的变更不会造成大量的哈希重定位。一致性哈希算法由此而生。**












































































